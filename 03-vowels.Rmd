---
editor_options: 
  chunk_output_type: console
---

```{r setup03, include=FALSE}
options(digits = 3)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
theme_set(theme_bw()+theme(text = element_text(size=18)))
```

# Vowels

## Theory

### Recap

* Sound waves can be described as

$$
s(t) = A \times \cos(2\pi ft + \phi)
$$

  * A — amplitude;
  * f — is the fundamental frequency;
  * φ — phase;
  * t — time.
  
* Speech sounds are complex waves
* Fourier transform --- allows to extract components of the complex wave
* [Larynx produce some sound](https://github.com/agricolamz/2022_HSE_m_Instrumental_phonetics/blob/master/images/03.01_larynx.mp4?raw=true)
* [Vocal tract filter some frequencies](https://github.com/agricolamz/2022_HSE_m_Instrumental_phonetics/blob/master/images/03.02_MRI-speech.mp4?raw=true)

```{r}
knitr::include_graphics("images/01.07-source-filter.png", dpi = 100)
```

### How shape of the vocal tract influences on vowels? Tube model.

Historically, height and backness are impressionistic linguistic terms:

```{r}
knitr::include_graphics("images/03.03_vowel.png", dpi = 300)
```

But we are intersted just in a cardinal points:

```{r}
knitr::include_graphics("images/03.04_cardinal_vowels.png", dpi = 300)
```

```{r}
knitr::include_graphics("images/03.05_faces.png", dpi = 170)
```

If we analyze acoustics we can get something like this:

```{r}
knitr::include_graphics("images/03.06_plots.png", dpi = 200)
```

|    |   i  |   a  |  u  |
|:--:|:----:|:----:|:---:|
| F1 |  300 |  700 | 300 |
| F2 | 2300 | 1400 | 800 |

However, if we analyze real sounds it could be messy:

```{r}
library(phonTools)
data(pb52)
pb52 %>% 
  mutate(vowel = case_when(vowel == "I" ~ "ɪ",
                           vowel == "E" ~ "ɛ",
                           vowel == "i" ~ "i",
                           vowel == "u" ~ "u",
                           vowel == "{" ~ "æ",
                           vowel == "V" ~ "ʌ",
                           vowel == "A" ~ "ɑ",
                           vowel == "O" ~ "ɔ",
                           vowel == "U" ~ "ʊ",
                           vowel == "3'" ~ "ɝ")) %>% 
  ggplot(aes(f2, f1, label = vowel, color = vowel))+
  stat_ellipse()+
  geom_text()+
  scale_x_reverse()+
  scale_y_reverse()
```

Tube model, after [@fant70]: vocal tract is a tube or a set of tubes:

```{r}
knitr::include_graphics("images/03.07_tubes.png", dpi = 300)
```

### Wavelength

```{r}
knitr::include_graphics("images/03.08-wavelength.png", dpi = 100)
```

$$c = \frac{\lambda}{T} = \lambda\times f \approx 33400\text{ cm/s}$$

* c  --- speed of sound; 
* λ --- wavelength; 
* f --- sound frequency; 
* T --- period.


Neutral vocal tract in the position for the vowel ə:

```{r}
knitr::include_graphics("images/03.09-shwa-tube.png", dpi = 100)
```


Resonance is a phenomenon in which a vibrating system or external force drives another system to oscillate with greater amplitude at specific frequencies. The lowest natural frequency at which such a tube resonates will have a wavelength (λ) **four times the length of the tube** (L).

$$c = \frac{\lambda}{T} = \lambda\times f \approx 33400\text{ cm/s}$$

The tube also resonates at **odd multiples** of that frequency.

$$F_1 = \frac{c}{\lambda} = \frac{c}{4 \times L} \approx 500 \text{ Hz}$$
$$F_2 = \frac{c}{\lambda} = \frac{c}{\frac{4}{3} \times L} = \frac{3 \times c}{4 L} \approx 1500 \text{ Hz}$$
$$F_3 = \frac{c}{\lambda} = \frac{c}{\frac{4}{5} \times L} = \frac{5 \times c}{4 L} \approx 2500 \text{ Hz}$$
$$F_n = \frac{c}{\lambda} = \frac{c}{\frac{4}{n} \times L} = \frac{n \times c}{4 L} \approx n \times 500 \text{ Hz}$$

Something like this we can expect from animals:

```{r}
knitr::include_graphics("images/03.10-cat-meow.png")
```

<audio controls>
<source src = "cat.wav">
</audio>

When there is a constriction, back tube and constriction form [Helmholtz resonator](https://en.wikipedia.org/wiki/Helmholtz_resonance).

$$f = \frac{c}{2\pi} \times \sqrt{\frac{A}{V\times L}}$$

* A --- the area of the neck; 
* L --- length of the tube; 
* V --- volume of the air in the body.

```{r}
knitr::include_graphics("images/03.11-tubes.png", dpi = 100)
```

### Other models

* Perturbation Theory [Kajiyama 1941, Mrayati et al. 1988]
* Quantal Theory [@stevens72]
* Theory of adaptive dispersion [@lindblom88]

## Practice of the phonetic fieldwork with `phonfieldwork`

We will work with examples from Abaza and will try to end up with something like this:

```{r abaza-example, cache=TRUE}
library(phonfieldwork)
draw_sound("sounds/abaza_vowels.wav",
           "sounds/abaza_vowels.TextGrid", 
           zoom = c(0,8.3))
```

### Befor we start

I expect you 

* to install `tidyverse` and `phonfieldwork`:

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = TRUE, message = TRUE)
```

```{r, eval=FALSE}
install.packages(c("tidyverse", "rmarkdown", "phonfieldwork"))
```

* load the library:

```{r}
library(phonfieldwork)
```


I will use the following version of the package:

```{r}
packageVersion("phonfieldwork")
```

* download files for todays seminar:
    * [first file](https://github.com/agricolamz/2022_HSE_m_Instrumental_phonetics/blob/master/sounds/examples/01.wav?raw=true)
    * [second file](https://github.com/agricolamz/2022_HSE_m_Instrumental_phonetics/blob/master/sounds/examples/01.wav?raw=true)

### Philosophy of the `phonfieldwork` package

Most phonetic research consists of the following steps:

1. Formulate a research question. Think of what kind of data is necessary to answer this question, what is the appropriate amount of data, what kind of annotation you will do, what kind of statistical models and visualizations you will use, etc.
2. Create a list of stimuli.
3. Elicite list of stimuli from speakers who signed an *Informed Consent* statement, agreeing to participate in the experiment to be recorded on audio and/or video. Keep an eye on recording settings: sampling rate, resolution (bit), and number of channels should be the same across all recordings.
4. Annotate the collected data.
5. Extract the collected data.
6. Create visualizations and evaluate your statistical models.
7. Report your results.
8. Publish your data.

The `phonfieldwork` package is created for helping with items 3, partially with 4, and 5 and 8.

To make the automatic annotation of data easier, I usually record each stimulus as a separate file.  While recording, I carefully listen to my consultants to make sure that they are producing the kind of speech I want: three isolated pronunciations of the same stimulus, separated by a pause and contained in a carrier phrase. In case a speaker does not produce three clear repetitions, I ask them to repeat the task, so that as a result of my fieldwork session I will have:

* a collection of small soundfiles (video) with the same sampling rate, resolution (bit), and number of channels
* a list of succesful and unsuccesful attempts to produce a stimulus according to my requirements (usually I keep this list in a regular notebook)

### Make a list of your stimuli

First we need to create a list of stimuli. We want to record two Abaza words from speakers (in real life word lists are much longer).

```{r}
my_stimuli_df <- read.csv("https://raw.githubusercontent.com/agricolamz/2022_HSE_m_Instrumental_phonetics/master/data/my_stimuli_df.csv")
my_stimuli_df
```

It is also possible to store your list as a column in an `.xls` or `xlsx` file and read it into R using the `read_xls` or `read_xlsx` functions from the `readxl` package. If the package `readxl` is not installed on your computer, you can install it using `install.packages("readxl")`.

### Create a presentation based on a list of stimuli

You can show a native speaker your stimuli one by one or not show them the stimuli but ask them to pronounce a certain stimulus or its translation. I use presentations to collect all stimuli in a particular order without the risk of omissions.

When the list of stimuli is loaded into R, you can create a presentation for elicitation. It is important to define an output directory, so in the following example I use the `getwd()` function, which returns the path to the current working directory. You can set any directory as your current one using the `setwd()` function. It is also possible to provide a path to your intended output directory with `output_dir` (e. g. "/home/user_name/..."). This command (unlike `setwd()`) does not change your working directory.

```{r}
create_presentation(stimuli = my_stimuli_df$stimuli,
                    output_file = "first_example",
                    output_dir = "sounds/")
```

As a result, a file "first_example.html" was created in the output folder. You can change the name of this file by changing  the `output_file` argument. The `.html` file now looks as follows:

<iframe src="https://agricolamz.github.io/2022_HSE_m_Instrumental_phonetics/additional/first_example.html" width = 700 height = 600>
  <p>Your browser does not support iframes :(</p>
</iframe>

It is also possible to change the output format, using the `output_format` argument. By dafault it is "html", but you can also use "pptx". There is also an additional argument `translations`, where you can provide translations for stimuli in order that they appeared near the stimuli on the slide.

```{r}
create_presentation(stimuli = my_stimuli_df$stimuli, 
                    translations = my_stimuli_df$translation,
                    output_file = "second_example",
                    output_dir = "sounds/")
```

<iframe src="https://agricolamz.github.io/2022_HSE_m_Instrumental_phonetics/additional/second_example.html" width = 700 height = 600>
  <p>Your browser does not support iframes :(</p>
</iframe>